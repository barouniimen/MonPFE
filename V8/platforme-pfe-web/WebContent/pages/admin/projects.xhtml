<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

	<h:form id="form">
		<p:contextMenu for="managedProj" style="width:110px">
			<p:menuitem value="Modifier" icon="ui-icon-pencil"
				oncomplete="EditProjDialog.show() "
				actionListener="#{projectsBean.updateProject()}" update=":tabView"/>
			<p:menuitem value="Supprimer" icon="ui-icon-trash"
				oncomplete="confirmationRemove.show()"
				actionListener="#{projectsBean.updateProject()}" update="confirmDialogRemove" />
		</p:contextMenu>

		<p:dataTable id="managedProj" var="proj"
			value="#{projectsBean.managedProj}"
			selection="#{projectsBean.selectedProject}" rowKey="#{proj.idPorj}"
			selectionMode="single" rows="20"
			emptyMessage="Aucun projet a afficher" paginator="true"
			paginatorPosition="bottom" liveResize="true">

			<f:facet name="header">
				<div
					style="float: left; padding-top: 2px; text-decoration: underline;">
					<p:commandLink id="buttonAddProject" value="Ajouter un projet" 
						oncomplete="AddProjDialog.show(); return false;" />
				</div>
				<!-- a developpe -->
				<div style="text-align: right; margin-left: 60%;">
					<p:outputPanel>
						<p:inputText widgetVar="filterProjects" id="globalFilter"
							onkeyup="managedProj.filter()"
							onblur="this.value='Rechercher...';" onclick="this.value='';"
							value="Rechercher..." />
					</p:outputPanel>
				</div>
			</f:facet>

			<p:column headerText="Sujet" style="max-width: 150px;"
				styleClass="wrap">  
            #{proj.projTopic}  
       		</p:column>

			<p:column headerText="Date de d#{msg['encodage.e.accent.grave']}but"
				style="width:25%" styleClass="wrap">  
            #{proj.startDate}  
        </p:column>

			<p:column headerText="Etudiant" style="width:24%" styleClass="wrap">  
            #{proj.studentName}#{msg['message.espace']}#{proj.studentFirstName} 
        </p:column>

			<p:column headerText="Entreprise" style="width:24%" styleClass="wrap">  
            #{proj.companyName}  
        </p:column>

			<p:column headerText="Etat de validation" style="width:24%"
				styleClass="wrap">  
            #{proj.projState.description}  
        </p:column>

			<p:column
				headerText="Encadrant c#{msg['encodage.o.chapeau']}t#{msg['encodage.e.accent.grave']} entreprise"
				style="width:24%" styleClass="wrap">  
            #{proj.companyCoachName}#{msg['message.espace']}#{proj.companyCoachFirstName}  
        </p:column>

			<p:column
				headerText="Encadrant c#{msg['encodage.o.chapeau']}te #{msg['encodage.e.accent.grave']}cole"
				style="width:24%" styleClass="wrap">  
            #{proj.coachName}#{msg['message.espace']}#{proj.coachFirstName}
        </p:column>

			<p:column headerText="Rapporteur" style="width:24%" styleClass="wrap">   
            #{proj.correctorName}#{msg['message.espace']}#{proj.correctorFirstName}  
        </p:column>
		</p:dataTable>

<p:confirmDialog id="confirmDialogRemove" closeOnEscape="true"
			appendToBody="true"
			message="Vous #{msg['encodage.e.chapeau']}tes sur le point de supprimer le projet  #{projectsBean.selectedProject.projTopic} . Voulez-vous continuer ?"
			header="Confirmez la suppression ..." severity="alert"
			widgetVar="confirmationRemove">

			<p:commandButton id="confirmRemove" value="Continuer" />
			<p:commandButton id="declineRemove" value="Annuler"
				onclick="confirmationRemove.hide()" />

		</p:confirmDialog>


	</h:form>

		
		<p:dialog id="dialogEdit" header="Modifier un projet"
			widgetVar="EditProjDialog" resizable="false" hideEffect="explode"
			modal="true" closable="true">

			<h:form id="EditForm">
			<p:growl id="growlEdit" showDetail="true" />
			<ui:include src="/pages/admin/forms/updateProject.xhtml" />
			<br />
			<br />
			  <p:commandButton id="submitProjectModif" value="Ajouter" update="growlEdit"
                    actionListener="#{addProjectFormBean.addProject}" />
                 
                    
			<p:commandButton type="reset" value="Annuler" update="addForm" />


		</h:form>


		</p:dialog>

		<p:dialog id="dialogAdd" header="Ajouter un projet"
			widgetVar="AddProjDialog" 
			modal="true" height="450px" appendToBody="true">
	
	
			<h:form id="addForm">
				<p:growl id="growlMsg" showDetail="true" />
				<ui:include src="/pages/admin/forms/addProject.xhtml" />
				<br />
				<br />
				  <p:commandButton id="submitProject" value="Ajouter" update="addForm"
	                    actionListener="#{addProjectFormBean.addProject}" oncomplete="handleLoginRequest(xhr, status, args)"/>
	                 
	                    
				<p:commandButton type="reset" value="Annuler" update="addForm" />
	
	
			</h:form>
	
		</p:dialog>

	
<script type="text/javascript">

    function handleLoginRequest(xhr, status, args) {
        if(args.validationFailed || !args.valid) {
          
        } 
        else {
            
            AddProjDialog.hide();
          
        }
    }
    
</script>
              




</ui:composition>